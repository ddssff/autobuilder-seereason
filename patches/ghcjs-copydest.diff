--- old/Setup.hs	2014-06-26 12:07:34.000000000 -0700
+++ new/Setup.hs	2014-06-26 14:30:54.526825937 -0700
@@ -9,7 +9,7 @@
 import           Data.Maybe            (maybe, listToMaybe)
 import           Data.Version          (showVersion)
 
-import           Distribution.PackageDescription
+import           Distribution.PackageDescription hiding (Flag)
 import           Distribution.Simple
 import           Distribution.Simple.LocalBuildInfo
 import           Distribution.Simple.Setup
@@ -49,7 +49,7 @@
         return () -- User has opted to skip wrapper script installation. Let's hope they know what they're doing.
                   -- Executables will keep their original names, e.g. ghcjs.bin, ghcjs-pkg.bin
   | otherwise = do
-        wrapperEnv <- getWrapperEnv verbosity descr installDirs exes
+        wrapperEnv <- getWrapperEnv verbosity descr (copyDest flags) installDirs exes
         mapM_ (copyWrapper verbosity wrapperEnv descr installDirs) exes
     where
       exes        = executables descr
@@ -71,17 +71,21 @@
 requiresWrapper :: String -> Bool
 requiresWrapper exe = ".bin" `isSuffixOf` exe
 
-getWrapperEnv :: Verbosity -> PackageDescription -> InstallDirs FilePath -> [Executable] -> IO WrapperEnv
-getWrapperEnv v descr installDirs exes
+getWrapperEnv :: Verbosity -> PackageDescription -> Flag CopyDest -> InstallDirs FilePath -> [Executable] -> IO WrapperEnv
+getWrapperEnv v descr copyDest' installDirs exes
   | [Executable name _ bi] <- filter ((=="ghcjs.bin").exeName) exes =
      let ghcjsVal xs =
            trim <$> rawSystemStdout v (bindir installDirs </> "ghcjs.bin") ["--ghcjs-setup-print", xs]
-     in  WrapperEnv <$> ghcjsVal"--print-default-topdir"
-                    <*> pure (bindir installDirs)
+     in  WrapperEnv <$> ghcjsVal "--print-default-topdir"
+                    <*> pure (dropPrefix copyDest' $ bindir installDirs)
                     <*> pure (showVersion . pkgVersion . package $ descr)
                     <*> ghcjsVal "--numeric-ghc-version"
   | otherwise = error "cannot find ghcjs.bin executable in package"
 
+dropPrefix (Flag (CopyTo pre)) s | isPrefixOf pre s = drop (length pre) s
+dropPrefix (Flag (CopyTo pre)) s = error $ "dropPrefix - " ++ show pre ++ " not a prefix of " ++ show s
+dropPrefix _ s = s
+
 {- |
      on Windows we can't run shell scripts, so we don't install wrappers
      just copy program.bin.exe to program.exe and
